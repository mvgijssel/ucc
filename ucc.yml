# the configuration of the application
config:

  exclude_models: User

  # the target database tables
  db:

    # the user table
    user:
      name: user
      id: id

    # the user group table
    group:
      name: usergroup
      id: id

    # the relationship database, connecting users to user groups
    membership:
      name: group_membership
      id: id
      user_id: user_id
      group_id: group_id

  # the code weaving configuration
  weaving:
    model: request / inherited / preload # how the weaving of functionality is done
    controller: request / inherited / preload # how the weaving of functionality is done


# all the collection definitions + request matching rules
collections:

  root:

    # groups for the root
    groups:
      - admin

  # model name of the collection
  project:

    models:
      - page

    class: project

    # the parent collection
    # reason not using yml nesting for parent/child relationship:
    # - because different files can contain collection definitions, would be very difficult merging with appropriate nesting levels
    parent: root

    # the url parameter which the determines the collection_id
    # which collection of the collections is active
    param: projects_controller

    # the user groups the collection creates
    groups:
      # user groups created by the collection
       # -> something like: project_user_1_group, 1 is the id of the project model
      - project_user
      - project_admin

  kek:

    parent: project

    param: kek_id

    groups:
      - kek_admin


# the sets / containers / folders of the application with associated security
security:

  root:

    pages_controller:

      page_editor:
        allow:
          ~

    media_controller:
      everyone:
        allow: ~

  # nesting of the containers, determines how the matching is done
  # this case: MUST MATCH root + project -> nil + project_id -> project_id
  project:

    pages_controller:

      groupaccount_admin:
        allow: ~

      groupaccount_member:
        allow:
          - index
          - show
          - edit

